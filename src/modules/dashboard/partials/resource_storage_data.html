<%const pool = (state.storage === false ? false : _.find(state.storage, (pool) => { return pool.name === 'messier'; }))%>
<li class="list-group-item storage-data py-3">
	<h6 class="d-flex align-items-center text-body-emphasis mb-0">
		<i class="icon-regular icon-database icon-fw me-1 text-gray-500"></i>
		Data
		<%if (state.storage !== null && pool !== false) {%>
			<u-badge color="<%=(pool.properties.health.value.toLowerCase() === 'online' ? 'green' : 'red')%>" class="ms-1" pill><%=pool.properties.health.value%></u-badge>
		<%}%>
	</h6>
	<%if (state.storage === null) {%>
		<div class="spinner-border spinner-border-sm text-gray-600"></div>
	<%} else if (pool === false) {%>
		<span class="text-red-300">Error fetching data</span>
	<%} else {%>
		<%const progressColorData = (pool.properties.capacity.value >= 80 ? (pool.properties.capacity.value >= 90 ? 'bg-red-300' : 'bg-orange-300') : 'bg-blue-300')%>
		<%const progressColorSnapshots = (pool.properties.capacity.value >= 80 ? (pool.properties.capacity.value >= 90 ? 'bg-red-200' : 'bg-orange-200') : 'bg-indigo-100')%>
		<div class="text-end mt-n3 mb-1">
			<small class="fw-light text-body-tertiary"><%=pool.properties.capacity.value?.toFixed(0)%>%</small>
			<u-progress>
				<u-progress-bar width="<%=(pool.properties.usedbydatasets.value / pool.properties.size.value * 100)%>" tip="Data"></u-progress-bar>
				<u-progress-bar color="indigo" tint="100" width="<%=(pool.properties.usedbysnapshots.value / pool.properties.size.value * 100)%>" tip="Snapshots"></u-progress-bar>
			</u-progress>
		</div>
		<div class="lh-1 text-body-tertiary mt-1">
			<small><strong class="fw-semibold"><%=prettyBytes(pool.properties.allocated.value || 0, { binary: true })%></strong> used from <%=prettyBytes(pool.properties.size.value || 0, { binary: true })%></small><br>
			<small class="d-none">Free: <%=prettyBytes(pool.properties.free.value || 0, { binary: true })%></small>
		</div>
		<div class="mt-1">
			<%_.each(state.drives, (drive) => {%>
				<%let color = 'gray'%>
				<%if (drive.temperature >= drive.temperatureWarningThreshold && drive.temperature < drive.temperatureCriticalThreshold) {%>
					<%color = 'yellow'%>
				<%}%>
				<%if (drive.temperature >= drive.temperatureCriticalThreshold) {%>
					<%color = 'red'%>
				<%}%>
				<u-badge color="<%=color%>" tint="200" class="me-1" tip="<%=_.last(drive.name.split('/'))%>" pill>
					<i class="icon-regular icon-hard-drive icon-fw me-1 text-gray-700"></i>
					<%=drive.temperature%> Â°C
				</u-badge>
			<%})%>
		</div>
		<%if (pool.scanStats && pool.scanStats?.state?.toLowerCase() !== 'finished') {%>
			<%const isPaused = (pool.scanStats.scrubPause > 0)%>
			<%const progress = (pool.scanStats.toExamine === 0 ? 0 : (pool.scanStats.issued / pool.scanStats.toExamine) * 100)%>
			<div class="lh-1 text-body-tertiary mt-3">
				<small>
					<%if (isPaused) {%>
						Data integrity check paused
					<%} else {%>
						Running data integrity check...
					<%}%>
				</small>
			</div>
			<div class="row g-0 d-flex align-items-baseline">
				<div class="col">
					<u-progress>
						<u-progress-bar color="cyan" tint="300" width="<%=progress%>" striped="<%=(!isPaused)%>" animated="<%=(!isPaused)%>" warning-threshold="999" danger-threshold="999"></u-progress-bar>
					</u-progress>
				</div>
				<div class="col-auto lh-1 text-body-tertiary text-end" style="width: 45px;">
					<small class="fw-light"><%=progress.toFixed(0)%>%</small>
				</div>
			</div>
		<%}%>
	<%}%>
</li>
